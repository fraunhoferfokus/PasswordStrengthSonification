<!DOCTYPE html>
<html>
<meta charset="UTF-8">

<head>
    <title>PasswordStrengthSonification</title>
    <!--<script type="text/javascript" src="../dep/base/Tone.js"></script> -->
    <!--<script type="text/javascript" src="../dep/estimator/zxcvbn.js"></script>-->
    <!--<script type="module" src="../scripts/InverseParkingSensor.js"></script>-->
    <link rel="stylesheet" type="text/css" href="style_examples.css">
</head>

<body>
    <div class="centerbox">
        <p>
            <h1>Password Strength Sonification Example</h1>
        </p>
        <form action="javascript:void(0);"><!-- prevents form submit / page reloading on Enter press in textinput-->
            <p id="passwordarea">
                <table><tr>
                    <td><span class="largeFont">Password to test: <input type="password" id="pwd" value=""> </span></td>
                    <td><input type="checkbox" id="showPassword"><label for="showPassword"> show password</label> &emsp; &emsp;
                        <input type="checkbox" id="soundActive" checked><label for="soundActive">&#x1f50a;sound active</label></td></tr>
                <tr><td></td>
                    <td><input type="checkbox" id="enableCommonPWCheck" checked><label for="enableCommonPWCheck">enable checking and feedback for the 100k most common passwords</label></td></tr>
                <tr><td></td>
                    <td><input type="checkbox" id="enableGradualVolumeAtFewCharacters" checked><label for="enableGradualVolumeAtFewCharacters">enable gradual volume fade-in at the first few characters</label></td></tr></table>
            </p>
            <p id="pwInfoOutput" class="pwInfoOutput">Password infos: -<br></p>
        </div></form>

    <script type="module">
        import { InverseParkingSensor } from '../scripts/InverseParkingSensor.js'
        import { PasswordChecker } from '../scripts/PasswordChecker.js'
        import {loadAndExecuteScript} from '../scripts/PWSon_HelperFunctions.js'

        /* ---- procedure ---- */
        loadAndExecuteScript("../dep/base/Tone.js")
        let sonification = new InverseParkingSensor()
        let passwordchecker = new PasswordChecker()
        sonification.setupSonification()
    
        registerInputEvents()


        /* ---- functions ---- */

        function checkPwdAndPlaySound(pwd) {
            let text = "Password infos:<br> <br>"
            let pwdResult = passwordchecker(pwd)
            
            if (pwdResult.isCommonPW) {
                ourScore = 0
                text += "Password is one of the 100k most common passwords, hence score=0!<br><br>"
                sonification.playCommonPWEventSound()
            }

            text += "Our Password score: " + pwdResult.score.toFixed(1) + "/10"
            document.getElementById("pwInfoOutput").innerHTML = text
            sonification.updateSonification(pwdResult.score, pwd.length)            
        }

        function registerInputEvents() {
            // register event listener for input (doesn't matter if it's key up or down -> on every input change)
            document.getElementById("pwd").addEventListener('input', (e) => {
                checkPwdAndPlaySound(document.getElementById("pwd").value)
            });
            document.getElementById("showPassword").addEventListener('change', (e) => {
                var pwinput = document.getElementById("pwd");
                if (e.target.checked) {
                    pwinput.type = "text";
                } else {
                    pwinput.type = "password";
                }
            });
            document.getElementById("soundActive").addEventListener('change', (e) => {
                if (e.target.checked) {
                    sonification.volume.mute = false
                } else {
                    sonification.volume.mute = true
                }
            });
            document.getElementById("enableGradualVolumeAtFewCharacters").addEventListener('change', (e) => {
                if (e.target.checked) {
                    sonification.enableGradualVolumeAtFewCharacters = true
                } else {
                    sonification.enableGradualVolumeAtFewCharacters = false
                }
            });
            document.getElementById("enableCommonPWCheck").addEventListener('change', (e) => {
                if (e.target.checked) {
                    passwordchecker.enableCommonPWCheck = true
                } else {
                    passwordchecker.enableCommonPWCheck = false
                }
            });
        }

    </script>
</body>
</html>